{% extends "base.html" %}

{% block title %}ì‹œìŠ¤í…œ ì„¤ì • ìˆ˜ì • - IT Log Device Manager{% endblock %}

{% block content %}
<div class="d-flex justify-content-between align-items-center mb-4">
    <h2><i class="fas fa-edit"></i> ì‹œìŠ¤í…œ ì„¤ì • ìˆ˜ì •</h2>
    <div class="btn-group" role="group">
        <a href="{{ url_for('config_admin.config_view', config_id=config_item.id) }}" class="btn btn-info">
            <i class="fas fa-eye"></i> ìƒì„¸ë³´ê¸°
        </a>
        <a href="{{ url_for('config_admin.config_list') }}" class="btn btn-secondary">
            <i class="fas fa-arrow-left"></i> ëª©ë¡ìœ¼ë¡œ
        </a>
    </div>
</div>

<form method="post">
    <div class="row">
        <div class="col-md-8">
            <div class="card">
                <div class="card-header bg-primary text-white">
                    <h5 class="mb-0">
                        <i class="fas fa-edit"></i> {{ config_item.category|title }}.{{ config_item.key }} ìˆ˜ì •
                    </h5>
                </div>
                <div class="card-body">
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><strong>ID</strong></label>
                            <input type="text" class="form-control" value="{{ config_item.id }}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><strong>ì¹´í…Œê³ ë¦¬</strong></label>
                            <div class="form-control d-flex align-items-center">
                                <span class="badge category-badge category-{{ config_item.category }} me-2">
                                    <i class="category-icon-{{ config_item.category }}"></i> {{ config_item.category }}
                                </span>
                            </div>
                        </div>
                    </div>
                    
                    <div class="row">
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><strong>ì„¤ì • í‚¤</strong></label>
                            <input type="text" class="form-control" value="{{ config_item.key }}" readonly>
                        </div>
                        <div class="col-md-6 mb-3">
                            <label class="form-label"><strong>ë°ì´í„° íƒ€ì…</strong></label>
                            <input type="text" class="form-control" value="{{ config_item.data_type }}" readonly>
                        </div>
                    </div>

                    <div class="mb-3">
                        <label for="value" class="form-label">
                            <strong>ì„¤ì • ê°’ <span class="text-danger">*</span></strong>
                        </label>
                        {% if config_item.data_type == 'json' or (config_item.value and config_item.value|length > 100) %}
                        <textarea class="form-control" id="value" name="value" rows="8" 
                                  placeholder="ì„¤ì • ê°’ì„ ì…ë ¥í•˜ì„¸ìš”" required>{{ config_item.value or '' }}</textarea>
                        {% else %}
                        <input type="text" class="form-control" id="value" name="value" 
                               value="{{ config_item.value or '' }}" placeholder="ì„¤ì • ê°’ì„ ì…ë ¥í•˜ì„¸ìš”" required>
                        {% endif %}
                        
                        {% if config_item.data_type == 'json' %}
                        <div class="form-text">
                            <i class="fas fa-info-circle text-info"></i> 
                            JSON í˜•ì‹ìœ¼ë¡œ ì…ë ¥í•´ì£¼ì„¸ìš”. ì˜¬ë°”ë¥´ì§€ ì•Šì€ JSONì€ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.
                        </div>
                        {% elif config_item.data_type == 'integer' %}
                        <div class="form-text">
                            <i class="fas fa-info-circle text-info"></i> 
                            ìˆ«ìë§Œ ì…ë ¥í•´ì£¼ì„¸ìš”.
                        </div>
                        {% elif config_item.data_type == 'boolean' %}
                        <div class="form-text">
                            <i class="fas fa-info-circle text-info"></i> 
                            'true' ë˜ëŠ” 'false'ë¥¼ ì…ë ¥í•´ì£¼ì„¸ìš”.
                        </div>
                        {% endif %}
                    </div>

                    <div class="mb-3">
                        <label for="gb" class="form-label"><strong>êµ¬ë¶„</strong></label>
                        <select class="form-select" id="gb" name="gb">
                            <option value="DEFAULT" {% if config_item.gb == 'DEFAULT' or not config_item.gb %}selected{% endif %}>DEFAULT</option>
                            <option value="SERVER" {% if config_item.gb == 'SERVER' %}selected{% endif %}>SERVER</option>
                            <option value="CLIENT" {% if config_item.gb == 'CLIENT' %}selected{% endif %}>CLIENT</option>
                        </select>
                        <div class="form-text">ì´ ì„¤ì •ì´ ì ìš©ë  ì‹¤í–‰ ëª¨ë“œë¥¼ ì„ íƒí•˜ì„¸ìš”.</div>
                    </div>

                    <div class="mb-3">
                        <label for="description" class="form-label"><strong>ì„¤ëª…</strong></label>
                        <textarea class="form-control" id="description" name="description" rows="3" 
                                  placeholder="ì´ ì„¤ì •ì— ëŒ€í•œ ì„¤ëª…ì„ ì…ë ¥í•˜ì„¸ìš”">{{ config_item.description or '' }}</textarea>
                        <div class="form-text">ì„¤ì •ì˜ ìš©ë„ë‚˜ ì£¼ì˜ì‚¬í•­ì„ ì„¤ëª…í•´ì£¼ì„¸ìš”.</div>
                    </div>
                </div>
            </div>
        </div>

        <div class="col-md-4">
            <div class="card">
                <div class="card-header bg-light">
                    <h6 class="mb-0"><i class="fas fa-info-circle"></i> í˜„ì¬ ì •ë³´</h6>
                </div>
                <div class="card-body">
                    <table class="table table-borderless table-sm">
                        <tr>
                            <th width="40%">ìƒì„±ì¼:</th>
                            <td><small>{{ config_item.created_at or '-' }}</small></td>
                        </tr>
                        <tr>
                            <th>ìˆ˜ì •ì¼:</th>
                            <td><small>{{ config_item.updated_at or '-' }}</small></td>
                        </tr>
                        <tr>
                            <th>ìˆ˜ì •ì:</th>
                            <td><small>{{ config_item.updated_by or '-' }}</small></td>
                        </tr>
                    </table>
                </div>
            </div>

            <div class="card mt-3">
                <div class="card-header bg-warning text-dark">
                    <h6 class="mb-0"><i class="fas fa-exclamation-triangle"></i> ì£¼ì˜ì‚¬í•­</h6>
                </div>
                <div class="card-body">
                    <ul class="mb-0 small">
                        <li>ì‹œìŠ¤í…œ ì„¤ì • ë³€ê²½ì€ ë§¤ìš° ì‹ ì¤‘í•˜ê²Œ í•´ì£¼ì„¸ìš”.</li>
                        <li>ì˜ëª»ëœ ì„¤ì •ì€ ì• í”Œë¦¬ì¼€ì´ì…˜ ì˜¤ë¥˜ë¥¼ ë°œìƒì‹œí‚¬ ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        <li>ì„¤ì • ë³€ê²½ í›„ ì• í”Œë¦¬ì¼€ì´ì…˜ ì¬ì‹œì‘ì´ í•„ìš”í•  ìˆ˜ ìˆìŠµë‹ˆë‹¤.</li>
                        {% if config_item.data_type == 'json' %}
                        <li class="text-danger"><strong>JSON í˜•ì‹ì„ ì •í™•íˆ ì…ë ¥í•´ì£¼ì„¸ìš”.</strong></li>
                        {% endif %}
                    </ul>
                </div>
            </div>
        </div>
    </div>

    <div class="d-flex gap-2 mt-4">
        <button type="submit" class="btn btn-primary btn-lg">
            <i class="fas fa-save"></i> ì„¤ì • ì €ì¥
        </button>
        <a href="{{ url_for('config_admin.config_view', config_id=config_item.id) }}" class="btn btn-secondary btn-lg">
            <i class="fas fa-times"></i> ì·¨ì†Œ
        </a>
    </div>
</form>
{% endblock %}

{% block styles %}
<style>
    /* ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ ë° ì•„ì´ì½˜ */
    .category-badge {
        font-size: 0.8em !important;
        font-weight: 600;
        padding: 0.4em 0.8em;
        border-radius: 12px;
        text-transform: uppercase;
        letter-spacing: 0.5px;
    }
    
    /* ì¹´í…Œê³ ë¦¬ë³„ ìƒ‰ìƒ ì •ì˜ */
    .category-database { 
        background: linear-gradient(135deg, #007bff, #0056b3) !important; 
        color: white !important;
        box-shadow: 0 2px 4px rgba(0, 123, 255, 0.3);
    }
    .category-socketserver { 
        background: linear-gradient(135deg, #28a745, #1e7e34) !important; 
        color: white !important;
        box-shadow: 0 2px 4px rgba(40, 167, 69, 0.3);
    }
    .category-flask { 
        background: linear-gradient(135deg, #6610f2, #495057) !important; 
        color: white !important;
        box-shadow: 0 2px 4px rgba(102, 16, 242, 0.3);
    }
    .category-authentication { 
        background: linear-gradient(135deg, #fd7e14, #dc6f00) !important; 
        color: white !important;
        box-shadow: 0 2px 4px rgba(253, 126, 20, 0.3);
    }
    .category-api { 
        background: linear-gradient(135deg, #17a2b8, #117a8b) !important; 
        color: white !important;
        box-shadow: 0 2px 4px rgba(23, 162, 184, 0.3);
    }
    .category-security { 
        background: linear-gradient(135deg, #dc3545, #bd2130) !important; 
        color: white !important;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.3);
    }
    .category-process { 
        background: linear-gradient(135deg, #6c757d, #495057) !important; 
        color: white !important;
        box-shadow: 0 2px 4px rgba(108, 117, 125, 0.3);
    }
    
    /* ì¹´í…Œê³ ë¦¬ ì•„ì´ì½˜ */
    .category-icon-database::before { content: "ğŸ—„ï¸ "; }
    .category-icon-socketserver::before { content: "ğŸŒ "; }
    .category-icon-flask::before { content: "âš¡ "; }
    .category-icon-authentication::before { content: "ğŸ” "; }
    .category-icon-api::before { content: "ğŸ“¡ "; }
    .category-icon-security::before { content: "ğŸ›¡ï¸ "; }
    .category-icon-process::before { content: "âš™ï¸ "; }
    
    /* ë‹¤í¬ëª¨ë“œì—ì„œ ì¹´í…Œê³ ë¦¬ ë°°ì§€ ì¡°ì • */
    [data-theme="dark"] .category-database { 
        background: linear-gradient(135deg, #0d6efd, #084298) !important;
        box-shadow: 0 2px 4px rgba(13, 110, 253, 0.4);
    }
    [data-theme="dark"] .category-socketserver { 
        background: linear-gradient(135deg, #198754, #0d5228) !important;
        box-shadow: 0 2px 4px rgba(25, 135, 84, 0.4);
    }
    [data-theme="dark"] .category-flask { 
        background: linear-gradient(135deg, #6f42c1, #3d2465) !important;
        box-shadow: 0 2px 4px rgba(111, 66, 193, 0.4);
    }
    [data-theme="dark"] .category-authentication { 
        background: linear-gradient(135deg, #fd7e14, #a0520d) !important;
        box-shadow: 0 2px 4px rgba(253, 126, 20, 0.4);
    }
    [data-theme="dark"] .category-api { 
        background: linear-gradient(135deg, #20c997, #0a5d3b) !important;
        box-shadow: 0 2px 4px rgba(32, 201, 151, 0.4);
    }
    [data-theme="dark"] .category-security { 
        background: linear-gradient(135deg, #dc3545, #8b1f2b) !important;
        box-shadow: 0 2px 4px rgba(220, 53, 69, 0.4);
    }
    [data-theme="dark"] .category-process { 
        background: linear-gradient(135deg, #adb5bd, #495057) !important;
        box-shadow: 0 2px 4px rgba(173, 181, 189, 0.4);
    }
</style>
{% endblock %}

{% block scripts %}
<script>
    // JSON í˜•ì‹ ê²€ì¦ (data_typeì´ jsonì¸ ê²½ìš°)
    {% if config_item.data_type == 'json' %}
    document.querySelector('form').addEventListener('submit', function(e) {
        const value = document.getElementById('value').value.trim();
        if (value) {
            try {
                JSON.parse(value);
            } catch (error) {
                e.preventDefault();
                alert('ì˜¬ë°”ë¥´ì§€ ì•Šì€ JSON í˜•ì‹ì…ë‹ˆë‹¤. ë‹¤ì‹œ í™•ì¸í•´ì£¼ì„¸ìš”.\n\nì˜¤ë¥˜: ' + error.message);
                return false;
            }
        }
    });
    {% endif %}

    // ìˆ«ì í˜•ì‹ ê²€ì¦ (data_typeì´ integerì¸ ê²½ìš°)
    {% if config_item.data_type == 'integer' %}
    document.getElementById('value').addEventListener('input', function(e) {
        const value = e.target.value;
        if (value && !/^-?\d+$/.test(value)) {
            e.target.setCustomValidity('ìˆ«ìë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        } else {
            e.target.setCustomValidity('');
        }
    });
    {% endif %}

    // Boolean í˜•ì‹ ê²€ì¦ (data_typeì´ booleanì¸ ê²½ìš°)
    {% if config_item.data_type == 'boolean' %}
    document.getElementById('value').addEventListener('input', function(e) {
        const value = e.target.value.toLowerCase();
        if (value && value !== 'true' && value !== 'false') {
            e.target.setCustomValidity('true ë˜ëŠ” falseë§Œ ì…ë ¥ ê°€ëŠ¥í•©ë‹ˆë‹¤.');
        } else {
            e.target.setCustomValidity('');
        }
    });
    {% endif %}
</script>
{% endblock %}